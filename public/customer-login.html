<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Customer Login</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <h2>Customer Login</h2>

  <form id="loginForm">
    <input
      type="text"
      id="mobile"
      placeholder="Mobile Number"
      required
    /><br><br>

    <input
      type="password"
      id="password"
      placeholder="Password"
      required
    /><br><br>

    <button type="submit">Login</button>
  </form>

  <br>
  <a href="/customer-register">New user? Register</a>

  <script>
    document.getElementById("loginForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      const mobile = document.getElementById("mobile").value;
      const password = document.getElementById("password").value;

      try {
        const res = await fetch("/api/customer-login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ mobile, password })
        });

        const data = await res.json();

        // Password was reset by admin
        if (data.reRegister) {
          alert("Your password was reset by admin. Please re-register.");
          window.location.href = "/customer-register";
          return;
        }

        // Successful login
        if (data.success) {
          localStorage.setItem("customer_id", data.customerId);
          window.location.href = "/customer";
          return;
        }

        // Any other error
        alert(data.error || "Login failed");

      } catch (err) {
        alert("Server error");
        console.error(err);
      }
    });
  </script>

</body>
</html>